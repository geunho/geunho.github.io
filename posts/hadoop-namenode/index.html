<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="no-referrer">
    

    
      <link href='https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400' rel='stylesheet' type='text/css'>
    

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <title>
      
      
         Hadoop NameNode 
      
    </title>
    <link rel="canonical" href="https://blog.geunho.dev/posts/hadoop-namenode/">

    <style>
  * {
    border:0;
    font:inherit;
    font-size:100%;
    vertical-align:baseline;
    margin:0;
    padding:0;
    color: black;
    text-decoration-skip: ink;
  }

  body {
    font-family:'Open Sans', 'Myriad Pro', Myriad, sans-serif;
    font-size:17px;
    line-height:160%;
    color:#1d1313;
    max-width:700px;
    margin:auto;
  }

  .footnotes {
    margin: 30px 0 40px 0;
  }
  sup.footnote-ref {
    font-size: 0.85em;
    vertical-align: top;
    position: relative;
    top: -0.5em;
  }

  footer {
    font-size: x-small;
    letter-spacing: 0.5px;
  }

  p {
    margin: 20px 0;
  }

  a img {
    border:none;
  }

  img {
    margin: 10px auto 10px auto;
    max-width: 75%;
    display: block;
  }

  .left-justify {
    float: left;
  }

  .right-justify {
    float:right;
  }

  pre, code {
    font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
    background-color: #f7f7f7;
  }

  code {
    font-size: 12px;
    padding: 4px;
  }

  pre {
    margin-top: 0;
    margin-bottom: 16px;
    word-wrap: normal;
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
  }

  pre>code {
    padding: 0;
    margin: 0;
    font-size: 100%;
    word-break: normal;
    white-space: pre;
    background: transparent;
    border: 0;
  }

  pre code {
    display: inline;
    max-width: auto;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: transparent;
    border: 0;
  }

  pre code::before,
  pre code::after {
    content: normal;
  }

  em,q,em,dfn {
    font-style:italic;
  }

  .sans,html .gist .gist-file .gist-meta {
    font-family:"Open Sans","Myriad Pro",Myriad,sans-serif;
  }

  .mono,pre,code,tt,p code,li code {
    font-family:Menlo,Monaco,"Andale Mono","lucida console","Courier New",monospace;
  }

  .heading,.serif,h1,h2,h3 {
    font-family:"Old Standard TT",serif;
  }

  strong {
    font-weight:600;
  }

  q:before {
    content:"\201C";
  }

  q:after {
    content:"\201D";
  }

  del,s {
    text-decoration:line-through;
  }

  blockquote {
    font-family:"Old Standard TT",serif;
    text-align:center;
    padding:50px;
  }

  blockquote p {
    display:inline-block;
    font-style:italic;
  }

  blockquote:before,blockquote:after {
    font-family:"Old Standard TT",serif;
    content:'\201C';
    font-size:35px;
    color:#403c3b;
  }

  blockquote:after {
    content:'\201D';
  }

  hr {
    width:40%;
    height: 1px;
    background:#403c3b;
    margin: 25px auto;
  }

  h1 {
    font-size:35px;
  }

  h2 {
    font-size:28px;
  }

  h3 {
    font-size:22px;
    margin-top:18px;
  }

  h1 a,h2 a,h3 a {
    text-decoration:none;
  }

  h1,h2 {
    margin-top:28px;
  }

  #sub-header, time {
    color:#403c3b;
    font-size:13px;
  }

  #sub-header {
    margin: 0 4px;
  }

  #nav h1 a {
    font-size:35px;
    color:#1d1313;
    line-height:120%;
  }

  .posts_listing a,#nav a {
    text-decoration: none;
  }

  li {
    margin-left: 20px;
  }

  ul li {
    margin-left: 5px;
  }

  ul li {
    list-style-type: none;
  }

  ul li:before {
    content:"\2022 \0020";
  }

  ul li ul li:before {
    content:"\2043 \0020";
  }

  #nav ul li:before, .posts_listing li:before {
    content:'';
    margin-right:0;
  }

  #content {
    text-align:left;
    width:100%;
    font-size:15px;
    padding:60px 0 80px;
  }

  #content h1,#content h2 {
    margin-bottom:5px;
  }

  #content h2 {
    font-size:25px;
  }

  #content .entry-content {
    margin-top:15px;
  }

  #content time {
    margin-left:3px;
  }

  #content h1 {
    font-size:30px;
  }

  .highlight {
    margin: 10px 0;
  }

  .posts_listing {
    margin:0 0 50px;
  }

  .posts_listing li {
    margin:0 0 25px 15px;
  }

  .posts_listing li a:hover,#nav a:hover {
    text-decoration: underline;
  }

  #nav {
    text-align:center;
    position:static;
    margin-top:60px;
  }

  #nav ul {
    display: table;
    margin: 8px auto 0 auto;
  }

  #nav li {
    list-style-type:none;
    display:table-cell;
    font-size:15px;
    padding: 0 20px;
  }

  #links {
    margin: 50px 0 0 0;
  }

  #links :nth-child(2) {
    float:right;
  }

  img.avatar {
    border-radius: 50%;
    width: 300px;
  }

   
  .social_id {
    color:#9b9b9b; 
    font-size:10px;
    text-align:center;
  }
  .social-icons {
    display: flex;
    justify-content: center;
  }
  .social-icons__icon {
    width: 1.5rem;
    height: 1.5rem;
    background-size: contain;
    background-repeat: no-repeat;
  }
  
  .social-icons__icon--linkedin {
    background-image: url(/icons/linkedin.svg);
    margin-right: 2rem;    
  }
  .social-icons__icon--github {
    background-image: url(/icons/github.svg);
    margin-right: 2rem; 
  }
  .social-icons__icon--gmail {
    background-image: url(/icons/gmail.svg);
  }

  .rss-icon {
    display: flex;
    width: 1.2rem;
    height: 1.2rem;
    background-size: contain;
    background-repeat: no-repeat;
    background-image: url(/icons/rss.svg);
  }

  #not-found {
    display: flex;
  }
  .not-found__icon--docker {
    width: 1.4rem;
    height: 1.4rem;
    margin-right: 0.5em;
    background-size: contain;
    background-repeat: no-repeat;
    background-image: url(/icons/docker.svg);
  }

  nav#TableOfContents {
    margin: 20px 0 50px 0;
  }

  @media (max-width: 750px) {
    body {
      padding-left:20px;
      padding-right:20px;
    }

    img {
      max-width: 80%;
    }

    #nav h1 a {
      font-size:28px;
    }

    #nav li {
      font-size:13px;
      padding: 0 15px;
    }

    #content {
      margin-top:0;
      padding-top:50px;
      font-size:14px;
    }

    #content h1 {
      font-size:25px;
    }

    #content h2 {
      font-size:22px;
    }

    .posts_listing li div {
      font-size:12px;
    }
  }

  @media (max-width: 400px) {
    body {
      padding-left:20px;
      padding-right:20px;
    }

    img {
      max-width: 100%;
    }

    #nav h1 a {
      font-size:22px;
    }

    #nav li {
      font-size:12px;
      padding: 0 10px;
    }

    #content {
      margin-top:0;
      padding-top:20px;
      font-size:12px;
    }

    #content h1 {
      font-size:20px;
    }

    #content h2 {
      font-size:18px;
    }

    .posts_listing li div{
      font-size:12px;
    }

    img.avatar {
      border-radius: 50%;
      width: 170px;
    }
  }
</style>


    
  </head>

  <body>
    <section id=nav>
      <h1><a href="/">Blog · 김근호(Kim, Geunho)</a></h1>
      <ul>
        
          <li><a href="/about">About</a></li>
        
          <li><a href="/posts">Posts</a></li>
        
          <li><a href="/thoughts">Thoughts</a></li>
        
          <li><a href="/til">TIL</a></li>
        
        <a class="rss-icon" href="/index.xml"></a>
      </ul>
    </section>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146312497-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




<section id="content">
  <h1> Hadoop NameNode </h1>

  
    <div id="sub-header">
      23 July 2019 · 3 minutes read
    </div>
  

  <nav id="TableOfContents">
  <ul>
    <li><a href="#secondary-namenode">Secondary NameNode</a></li>
    <li><a href="#standby-namenode">Standby NameNode</a></li>
    <li><a href="#journalnode">JournalNode</a></li>
  </ul>
</nav>

  <div class="entry-content">
    <h1 id="architecture">Architecture</h1>
<p>하둡 클러스터는 단일 마스터 노드와 여러 대의 워커 노드로 이루어진 Master/Slave 구조이다. 마스터 노드는 NameNode라 불리며 하둡 분산 파일 시스템(HDFS, Hadoop Distributed File System)의 네임스페이스를 관리하며, 워커 노드인 <a href="/posts/hadoop-datanode/">DataNode</a>는 파일 시스템의 파일 블록을 저장하는 역할을 한다.</p>
<p><img src="/hadoop-namenode-1.png" alt="하둡 클러스터 구조"> <em>그림 1. Master/Slave 구조</em></p>
<p>HDFS는 MapReduce 프레임워크와 함께 하둡을 구성하는 한 줄기인데, 용량이 큰 규모의 파일을 분산 저장하기 위해 설계되었다. 큰 용량의 파일이란 수십 기가바이트에서 테라바이트까지의 규모를 뜻하는데, 이러한 파일을 블록 단위로 나누어 저장한다.</p>
<p>NameNode는 분산 파일 시스템의 네임스페이스를 관리한다. 파일 시스템 트리와 트리 안의 모든 파일 및 디렉토리에 대한 메타 정보를 유지하고 있다. 파일이 어느 노드에 위치한 블록으로 구성되어 있는지 알고 있으며, 모든 변경 사항을 기록한다.</p>
<p>이와 같은 정보는 NameNode의 호스트 OS의 로컬 파일 시스템에 두 가지 종류의 파일로 지속해서 기록한다. 파일의 변경 사항은 트랜잭션 로그에 해당하는 <code>EditLog</code>에 저장되고 전체 이미지 정보는 <code>FsImage</code>에 저장된다. 이 파일들은 클러스터 장애로 인해 NameNode를 재시작할 때 파일 시스템의 네임스페이스와 메타 정보를 복구하는데 사용된다.</p>
<ul>
<li>EditLog : HDFS의 모든 변경 사항에 대한 트랜잭션 로그 정보</li>
<li>FsImage : HDFS의 전체 이미지 정보</li>
<li>두 정보는 NameNode가 동작하는 OS의 로컬 파일 시스템에 기록되고 NameNode 복구시 사용</li>
</ul>
<p><img src="/hadoop-namenode-2.png" alt="네임스페이스와 메타 정보"> <em>그림 2. EditLog와 FsImage. 클라이언트가 NameNode로 명령을 내리면 NameNode는 파일 변경 사항을 EditLog 파일에 기록한다. NameNode가 재시작 되면 네임스페이스를 복구하기 위해 FsImage를 먼저 읽어들인 후 EditLog의 내용을 차례로 병합하여 기동한다. EditLog 수가 늘어날 수 록 기동 시간은 늘어나게 된다.</em></p>
<hr>
<h1 id="persistency">Persistency</h1>
<p>만약 NameNode 장비에 이상이 생겨서 프로세스가 다운된다면 어떻게 될까? 단일 마스터 노드인 NameNode가 중지되는 즉시 HDFS는 사용할 수 없는 상태가 된다. 특히 NameNode에 디스크 장애가 발생한다면, 로컬 파일 시스템에 저장되어 있는 FsImage와 EditLog 모두 유실될 수 있는데 초창기의 하둡 1에서는 이를 다시 복구할 수 있는 방안을 제공한다.</p>
<p>하지만 NameNode의 장애로 인한 단일 지점 실패(SPOF, Single Point Of Failure)는 막을 수 없었다. NameNode 장비에 문제가 생기면 문제를 해결할 때까지는 전체 하둡 클러스터를 사용할 수 없는 것이다. 하둡 2부터는 고가용성(HA, High Availability) 기능이 제공되는데, Active-Standby 두 개의 NameNode를 구성함으로서 NameNode 장애로 인한 SPOF를 막을 수 있게 되었다.</p>
<h2 id="secondary-namenode">Secondary NameNode</h2>
<p>하둡 1에서 제공하는 NameNode 장애시 데이터 복구를 위한 노드이다. NameNode의 FsImage와 EditLog를 주기적으로 폴링하여 백업하고, 쌓여있는 EditLog를 FsImage에 병합(merge)한다. 병합된 변경 사항은 다시 NameNode로 전달하여 동기화한다. 이러한 과정을 체크포인트라고 한다. CPU와 IO가 많이 필요한 작업이기 떄문에 별도의 노드에서 수행하는 것이다.하둡 2에서도 HA 구성을 활성화 하지 않으면 Secondary NameNode를 FsImage와 EditLog의 백업 및 병합 용도로 사용할 수 있다.</p>
<p><img src="/hadoop-namenode-3.png" alt="Secondary NameNode"> <em>그림 3. 체크포인트. SNN는 EditLog와 FsImage를 백업하고 EditLog를 병합하는 역할을 한다.</em></p>
<p>설명과 그림은 간단하게 표현햤지만 Secondary NameNode는 NameNode에게 RPC와 여러 번 HTTP 요청을 해서 체크포인트를 진행한다.</p>
<ol>
<li>NameNode 이미지의 트랜잭션 아이디를 확인</li>
<li>NameNode의 EditLog를 rolling 하도록 요청</li>
<li>NameNode의 FsImage와 EditLog를 가져옴</li>
<li>FsImage 확인 후 네임스페이를 새로 갱신</li>
<li>EditLog 적용</li>
<li>새로운 FsImage 생성</li>
<li>NameNode로 새로운 이미지 업로드</li>
</ol>
<h2 id="standby-namenode">Standby NameNode</h2>
<p>두 개의 NameNode를 구성하여 Active/Standby 상태를 갖게 하는데, 두 NameNode는 FsImage와 EditLog 저장을 위해 NFS와 같은 공유 저장소를 설정한다. Active 노드가 파일을 변경하면, Standby 노드가 감시(watch)하고 있다가 변경 사항을 자신의 네임스페이스에 똑같이 적용한다. 이렇게 동기화된 상태의 네임스페이스를 유지하여, Active 노드에 장애가 발생했을 때 Standby 노드가 Active 노드의 역할을 곧바로 수행한다. 이로서 SPOF 문제를 해결할 수 있다.</p>
<p>체크포인트는 Secondary NameNode에서 수행하는 것 보다 간결해졌다. Standby 노드는 공유 저장소의 EditLog를 계속해서 본인의 네임스페이스에 적용하므로, 네임스페이스를 새로운 FsImage로 저장하고 Active 노드에게 새로운 FsImage를 사용하도록 함으로서 완료된다.</p>
<p><img src="/hadoop-namenode-4.png" alt="Standby NameNode with NFS"> <em>그림 4. Active/Standby NameNode with NFS</em></p>
<h2 id="journalnode">JournalNode</h2>
<p>NFS와 같은 공유 저장소를 사용하는 방법은, 다시 이 공유 저장소의 장애로부터 자유롭지 못한 문제점을 낳는다. 공유 저장소 자체가 HA 구성이 되어있지 않으면 이 저장소가 SPOF가 될 수 있고 이로인해 전체 클러스터의 장애로 이어진다.</p>
<p>이 문제를 해결하기 위해 단일 공유 저장소 대신 NameNode에 JournalManager를 두고 JournalNode로 이루어진 분산 저장소에 FsImage와 EditLog를 저장하고 동기화하여 완벽히 HA를 보장할 수 있게 되었다.</p>
<p><img src="/hadoop-namenode-5.png" alt="Standby NameNode with JournalNode"> <em>그림 5. Active/Standby NameNode with JournalNode</em></p>
<hr>

  </div>

  
    <div id="sub-header">
      Updated 5 August 2019
    </div>
  

  <div id="links">
    
      <a class="basic-alignment left" href="https://blog.geunho.dev/posts/microservice-decomposing/">&laquo; 마이크로서비스 아키텍처(MSA) 경계 구분하기</a>
    
    
      <a class="basic-alignment left" href="https://blog.geunho.dev/posts/hadoop-datanode/">Hadoop DataNode &raquo;</a>
    
  </div>
</section>
<section id="comment">
  <script src="https://utteranc.es/client.js"
    repo="geunho/blog"
    issue-term="title"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>  
</section>

<footer>
  <div>
    <p>
    &copy; 2013-2020 Copyright Geunho Kim. All rights reserved.
    </p>
  </div>
</footer>

